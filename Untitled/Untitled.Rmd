---
title: "Changes in skin colour after sleep deprivation: Objective or subjective?"
author: ["<span class=\"presenter\">Benjamin C. Holding<sup>1</sup></span>, Tina Sundelin<sup>1</sup></span>, John Axelsson<sup>2</sup></span><ol class=\"affiliations\"><li>Department of Clinical Neuroscience, Karolinska Insitutet, Sweden</li><li>Stress Research Institute, Stockholm University, Sweden</li></ol>"]
output:
  drposter::revealjs_poster:
    self_contained: false
    css: poster.css
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)  # Hide code by default. Can override chunk-by-chunk
```

```{r, include=FALSE}
ipak <- function(pkg){
    new.pkg <- pkg[!(pkg %in% installed.packages()[, "Package"])]
    if (length(new.pkg)) 
        install.packages(new.pkg, dependencies = TRUE)
    sapply(pkg, require, character.only = TRUE)
} #function to see if package is installed. Will download if not, and then opens it.

packages <- c("plyr", "lme4", "nlme", "afex", "sjPlot", "lme4", "lmerTest", "brms", "ggridges", "reshape2")
suppressPackageStartupMessages(ipak(packages))

face.ratings.raw <- read.csv("sleep ratings.csv") #reads in raw face ratings from csv

face.ratings <- face.ratings.raw[complete.cases(face.ratings.raw),c(1,8,9,11)] #removes columns that are NA (pauses, instructions etc)

face.ratings$Instruction <- as.factor(gsub(".jpg", "", as.character(face.ratings$Instruction))) #removing .jpg from question factor
face.ratings$Face <- as.factor(gsub(".jpg", "", as.character(face.ratings$Face))) #removing .jpg from photo number
face.ratings$ID <- as.factor(gsub(".jpg", "", as.character(face.ratings$Face))) #need to create this to bind with slesi key

joined.raw <- join(face.ratings, read.csv("SleSI_Masterkey.csv")) #joins our DF with the slesi key
face.ratings.and.key <- joined.raw[,-5] #removed redundent ID column

health.ratings <- face.ratings.and.key[which(face.ratings.and.key$Instruction == "halsa"),] #making a seperate DF for health ratings
tiredness.ratings <- face.ratings.and.key[which(face.ratings.and.key$Instruction == "trotthet"),] #new DF for tiredness
paleness.ratings <- face.ratings.and.key[which(face.ratings.and.key$Instruction == "blek_hud"),] #new DF for paleness

objective.skin.raw <- read.csv("Data - Slesi_skin_colour_CLEAN.csv") #importing raw skin colour data
objective.skin <- subset(objective.skin.raw, objective.skin.raw$X == "Cheek_L" | objective.skin.raw$X =="Cheek_R" | objective.skin.raw$X == "Forehead") #making a DF for only face skin colour measures
SCM.raw.joined <- join(objective.skin, read.csv("SleSI_Masterkey.csv")) #joins our DF with the slesi key

priors=c(set_prior ("normal (0, 1)", class = "b", coef = "SD"))
Lightness.bayesian <- brm(L..D65. ~ SD + a..D65. + b..D65. + (1|ID), SCM.raw.joined, prior=priors, sample_prior = T)
Lightness.posterior <- posterior_samples(Lightness.bayesian)

Redness.model <- brm(a..D65. ~ SD + L..D65. + b..D65. + (1|ID), SCM.raw.joined, prior=priors, sample_prior = T)
Redness.posterior <- posterior_samples(Redness.model)

Yellowness.model <- brm(b..D65. ~ SD + L..D65. + a..D65. + (1|ID), SCM.raw.joined, prior=priors, sample_prior = T)
Yellowness.posterior <- posterior_samples(Yellowness.model)

data <- melt(data.frame(Lightness = Lightness.posterior$b_SD, Redness=Redness.posterior$b_SD, Yellowness=Yellowness.posterior$b_SD))
```


# {.col-1}

## Take Home Message

Sleep loss has been shown to lead to changes in subjectively rated facial appearance. Axelsson et al., (2010) found that sleep deprived individauls were subjectively rated as being less attractive and looking more tired. Sundelin et al. (2012) showed that specific facial muscular areas changed following sleep restriction that could act as cues of fatigue. A recent study (Sundelin et al, 2017) followed up to find that individuals were rated as 

# {.col-2}

## Introduction

Edit content in the *.Rmd and poster.css files to write up your poster and style it.  The poster output is best best viewed and printed in Chrome (though limited testing has also been done in Firefox).  The previewer built into RStudio has difficulties with the layout CSS, so it is best to refresh the generated html file in a dedicated browser.

For now, the title section of the poster is automatically generated from the yaml header in the markdown file.  Options for logos or other fields may be added later.  By default, the poster is an A0 portrait size, but this is easily adapted at the top of the CSS file (and may gain user-friendly aliases later for size and orientation).

Currently, there are a few conventions to define the poster layout.  Use level 1 sections (`#`) to denote main divisions of content.  Assigning a `{.col-x}` class, where `x` is 1--3, will stretch the container across the page width with `x` equal subcolumns, using Flexbox.  The actual content goes inside of level 2 containers (`## Block title here`).  There are also a few convenience classes, such as formatting a QR code block.  The markdown source for the poster perhaps provides the best documentation by example.

Ultimately, one of the main objectives of this project is to avoid manually tweaking the spacing, element-by-element, of content in PowerPoint or another program.  Instead, define the desired layout, page size, and other parameters get the spacing details automatically. (work in progress)


## Method

As an rmarkdown template, this format makes it easy to include plots and other analysis directly generated in R.  By default, the raw code is hidden.  The following plot of `cars` data is the classic example from R Markdown skeleton files...

```{r, echo=FALSE}
ggplot(data, aes(x=value, y=variable, height=..density.., fill = variable)) +
    geom_vline(xintercept = 0, col = "grey70") +
    geom_density_ridges2(col = "grey70", fill = "black", scale = 2.0)
```

...along with the corresponding statistical summary.

Images can also be loaded by file path using the standard Markdown syntax.  For example, some figures, such as illustrations, may be easiest in other software or analysis from other software (or collaborators who use different tools).  Other standard markdown commands should work out-of-the box, though their CSS styling has not yet been tested.

## Results

* Integration with default reveal.js themes (e.g. sky, moon) to automatically load fonts, colors, and other styles.
* Ideally, this could eventually be transformed into a "print as poster" extension for reveal.js slideshows, so the standard pandoc<span class="cite">4</span> template for revealjs could be used (including the default CSS and Javascript boilerplate that is currently removed).
* Implement several nice base poster styles similar to the tikzposter LaTeX class<span class="cite">5</span>, which provides full customization of the color palette, block styling, etc.
* Organize styles with SCSS or at least more similarly to standard reveal.js presentations.
* Bibliography: consider using markdown bibliographies, such as suggested by relevant R markdown documentation.<span class="cite">6</span>  Similarly with organizing the affiliations: possibly footnote syntax?  For both cases, this would be superior to the _ad hoc_ construction.
* Add a more traditional column-based format for academic posters.


## Summary

<div class="autofullwidth warning">
This repository is under development and should be considered alpha-level software.  **Do not use it directly for academic or professional content without having a proper backup to fully compile your posters.**  The CSS classes and/or notation are not finalized and may break without warning.
</div>

This package will be updated as I make new posters for research, but it's still a work in progress. Installation of this package is easy using the `devtools` package: simply run `devtools::install_github("bbucior/drposter")`.  After installation, the format will be available as an R Markdown template in the "New R Markdown" wizard.

<p class="qr">
![QR code](Resources/qr_code.png)
For more information, please visit the project page at <https://github.com/bbucior/drposter>.  Feel free to report issues, pull requests, or general comments on Github.
</p>


# {.col-3}

## References {style="width:64%"}

1. <http://lab.hakim.se/reveal-js/#/>
1. <https://github.com/rstudio/revealjs>
1. <http://rmarkdown.rstudio.com/developer_custom_formats.html>
1. <http://pandoc.org/>
1. <https://www.ctan.org/pkg/tikzposter>
1. <http://rmarkdown.rstudio.com/authoring_bibliographies_and_citations.html>
1. <https://openclipart.org/detail/169900/circuit-board>
1. <https://www.r-project.org/logo/>

## PsyArXiv

The background image for the example poster is derived from public domain work<span class="cite">7</span>.  The R logo<span class="cite">8</span> is copyright 2016 The R Foundation and dual-licensed as CC-BY-SA 4.0 or GPL-2.
This package is derived from the excellent reveal.js HTML presentation framework<span class="cite">1</span> and corresponding R package.<span class="cite">2</span>